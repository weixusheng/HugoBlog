# 计算机组成原理 Part-2


总线
<!--more--> 

# 总线概念
总线是连接各个部件的信息传输线,分为串行和并行两种类型
 - 串行
一条线路,数据只能进行排队发送,不存在时延问题,目前的主流,因为可以通过不断提升的频率来弥补单条线路发送速度低的问题,通常用于较长距离的传输,成本低,实现简单
 - 并行:
多条线路可同时发送一条数据,由于需要去除并行中不同线路的时延,所以需要将较短的线路做成弯曲的形状,让并行线路中所有线路长度都相同,适用于较短距离的传输,目前已发展到速度瓶颈,因为越来越高的频率造成线路不同时到达的概率就越高,且解决成本高,实现复杂

# 总线结构
## 单总线结构
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/1.png)

## 多总线结构
### 双总线
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/6.png)

### 三总线
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/7.png)

### 三总线cache
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/8.png)

### 四总线
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/9.png)

### 以cpu为中心的双总线
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/2.png)

### 以存储器为中心的双总线
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/3.png)

### 传统微型机总线结构
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/10.png)

### VL-BUS局部总线结构
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/11.png)

### PCI 总线结构
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/12.png)

### 多层总线结构
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/13.png)

# 总线的分类
1. 片内总线: 芯片内部的总线

2. 系统总线: 计算机各部件之间的信息传输线
 - 数据总线: 双向 与机器字长、存储字长有关
 - 地址总线: 单向 与存储地址、 I/O地址有关
 - 控制总线: (出)中断请求、总线请求,(入)存储器读、存储器写总线允许、中断确认

3. 通信总线: 用于 计算机系统之间 或 计算机系统与其他系统(如控制仪表、移动通信等)之间的通信
 - 串行通信总线
 - 并行通信总线

# 总线特性
总线是主板的主要部分,负责各组件之间的数据传输
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/4.png)
1. 机械特性: 尺寸、形状、管脚数及排列顺序
2. 电气特性: 传输方向和有效的电平范围
3. 功能特性: 每根传输线的功能(地址,数据,控制)
4. 时间特性: 信号的时序关系

## 总线的性能指标
1. 总线宽度: 数据线的根数
2. 标准传输率: 每秒传输的最大字节数(MBps)
3. 时钟同步/异步: 同步、不同步
4. 总线复用: 地址线与数据线复用
5. 信号线数: 地址线、数据线和控制线的 总和
6. 总线控制方式: 突发、自动、仲裁、逻辑、计数
7. 其他指标: 负载能力

## 总线标准
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/5.png)

# 总线控制
## 总线判优控制
 - 主设备(模块) 对总线有控制权
 - 从设备(模块) 响应从主设备发来的总线命令

总线判优控制
1. 集中式
    - 链式查询
    - 计数器定时查询
    - 独立请求方式
2. 分布式

## 链式查询方式
通过BG线,在IO接口中逐个传递控制部件的数据
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/14.png)

## 计数器定时查询方式
将IO接口进行计数标号,控制部件的数据根据序号来传输
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/15.png)

## 独立请求方式
每一个IO接口都有BG和BR线,控制器进行单独控制
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/16.png)

# 总线的通信控制
解决通信双方**协调配合**问题

## 总线传输周期
 - 申请分配阶段: 主模块申请,总线仲裁决定
 - 寻址阶段: 主模块向从模块给出地址和命令
 - 传数阶段: 主模块和从模块交换数据
 - 结束阶段: 主模块撤消有关信息

## 总线通信的四种方式
 - 同步通信: 由统一时标控制数据传送
 - 异步通信: 采用应答方式,没有公共时钟标准
 - 半同步通信: 同步、异步结合
 - 分离式通信: 充分挖掘系统总线每个瞬间的潜力

### 同步式数据-输入
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/17.png)

### 同步式数据-输出
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/18.png)

### 异步通信
 - 不互锁: 双方闭眼睛传数据
 - 半互锁: 从设备对主设备进行数据确认
 - 全互锁: 双方都对数据进行确认

![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/19.png)

### 半同步通信 (同步、异步 结合)
 - 同步
发送方用系统时钟前沿发信号
接收方用系统时钟后沿判断、识别
 - 异步
允许不同速度的模块和谐工作,增加一条“等待”响应信号'WAIT'
 - 以输入数据为例的半同步通信时序
T<sub>1</sub>主模块发地址
T<sub>2</sub>主模块发命令
T<sub>w</sub>当'WAIT'为低电平时,等待一个 T
T<sub>w</sub>当'WAIT'为低电平时,等待一个 T
T<sub>3</sub>从模块提供数据
T<sub>4</sub>从模块撤销数据,主模块撤销命令

![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-2/20.png)

**上述三种通信的共同点**
一个总线传输周期(以输入数据为例)
 - 主模块发地址 、命令 占用总线
 - 从模块准备数据 不占用总线 总线空闲
 - 从模块向主模块发数据 占用总线

### 分离式通信
充分挖掘系统总线每个瞬间的潜力
**总线传输周期**
 - 子周期1: 主模块申请占用总线,使用完后即放弃总线的使用权
 - 子周期2: 从模块申请占用总线,将各种信息送至总线上

**分离式通信特点**
1. 各模块有权申请占用总线
2. 采用同步方式通信,不等对方回答
3. 各模块准备数据时,不占用总线
4. 总线被占用时,无空闲
充分提高了总线的有效占用




