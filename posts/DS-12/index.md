# 红黑树


学到STL中的set和map,发现底层实现是红黑树,之前一直听说过这个结构,这次遇到了实际应用,早晚都要学,不如今天学了
<!--more-->

# 红黑树概述
历史上AVL树流行的另一变种是红黑树（red-black tree）。对红黑树的操作能保证在最坏情况下动态几何操作的时间为O(logN) 。AVL树是在进行插入和删除操作时通过特定操作保持二叉查找树的平衡，从而获得较高的查找性能。
STL中的关联式容器默认的底层实现都是红黑树，以及Linux内核中包括进程队列等结构也是基于红黑树
红黑树是二叉查找树，但在每个节点上增加了一位存储位表示该节点的颜色，具体可以是 RED 或 BLACK。通过对任一条从根到叶子的路径上各节点着色方式的限制，红黑树确保了没有一条路径会比其他路径长到两倍，因而基本上是平衡的。它所追求的的是局部平衡而不是AVL树中的非常严格的平衡。
## 着色规则
1. 每个节点不是红色就是黑色
2. 根节点为黑色
3. 如果节点为红，其子节点必须为黑（一条路径上不能出现连续的两个红色节点）
4. 任一节点至NULL（树尾端）的任何路径，所含之黑节点数必须相同

根据规则4，新增节点必须为红；根据规则3，新增节点之父点必须为黑
当新节点根据二叉查找树的规则（键值大小）到达其插入点，却未能符合上述条件，**就必须调整颜色并旋转树形**
AVL 树插入节点后如果不满足其平衡条件，需要旋转树形。红黑树并不是基于 AVL 树的，它是在二叉查找树的基础上。
 - 一条路径上不能出现连续的两个红色节点，必须有黑色节点间隔开来
 - 红黑树的每条路径中所含黑色节点的数目必须相同，这样就限制每条路径之间的高度差，从而达到接近平衡的目的。

# 插入节点
同AVL树，红黑树的插入也要考虑以下几种情况，然后兼顾上面的着色法则。所有待插入节点初始着色为红色，最后将根节点重新设置为黑色。

## 空树
这是最简单的一种形式，直接添加，着色为黑色（规则2）

## 仅存在根节点（黑色），或待插入节点 X 的父节点 P 为黑色
直接添加即可，无需任何旋转和调整颜色。这种情况下，直接添加满足所有的着色法则，不用理会其叔节点的特征。

## 待插入节点 X 的父节点 P 为红色，且该父节点 P 为X 祖父节点G 的左儿子
这种情况下，又分为几种情况：

### X 的叔节点 S 为红色，（X 的叔节点就是 X 的祖父节点的右儿子）
此时存在红- 红的情况，父子节点同时为红色，不满足着色法则3，需要作出调整。
调整策略就是：将X 节点的父节点和叔节点着黑色，将其祖父节点着红色，这样该局部满足着色法则，但是尚不清楚其曾祖父GG节点的颜色，如果GG为红色，由于G也为红色，这样就不满足着色法则3，仍需要调整；如果GG为黑色就不需要调整了，这里的调整策略便是向上迭代调整，就是向上更换当前位置（将原当前位置X，设置为X的祖父节点G），再进行同等判断调整。如下图：
![IMG](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/DS-12/1.png)

### X 的叔节点 S 为黑色（NULL认为是黑色节点）
红黑树还有个规则就是NULL节点一律看作是黑节点，如某节点K 的右儿子不存在，即该右儿子看作是黑色节点，这个不影响着色法则。
叔节点S 为黑，这样就需要通过旋转和改变颜色来调整了，通过之前的 AVL 树，我们知道外侧插入和内侧插入的旋转不一样，外侧插入（这里的左左）只需单旋转，而内侧插入（左右）则需要双旋转。

1. 外侧插入，即待插入节点X 为其父节点的左儿子
这种情况下，需要进行单旋转然后调整颜色。关于外侧插入的旋转已经在AVL树中介绍，这里是相似的，不再赘述。实现细节看图便知
调整前后局部根节点还是黑色，也就是这种情况下只需要局部调整颜色然后单旋转即可，不需要向上迭代
![IMG](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/DS-12/2.png)

2. 内侧插入，即待插入节点X 为其父节点的右儿子
该情况下，需要先进行左旋转，然后调整颜色，然后再次进行右旋转即可，前后局部根节点依旧为黑色节点，同样不需要考虑上一层的红-红问题，实现细节如下图：
![IMG](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/DS-12/3.png)

上述第3点考虑的是待插入节点的父节点 P 为X 祖父节点G 的左儿子的情况，其作为右儿子也是类似的操作，差别在于旋转的先后顺序上，同AVL树的旋转调整。这里也顺便贴出来，见第4点

## 4、待插入节点 X 的父节点 P 为红色，且该父节点 P 为X 祖父节点G 的右儿子
同样分为以下几种情况，由于与第3点是对称性结构，这里就简单的贴图说明：

### X 的叔节点 S 为红色，（X 的叔节点就是 X 的祖父节点的左儿子）
此时同样需要解决红-红（父子节点同时为红色）的问题，调整位置向上迭代判断调整
![IMG](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/DS-12/4.png)

### X 的叔节点 S 为黑色（NULL认为是黑色节点）
需要考虑外侧插入和内侧插入的情况
1. 外侧插入，即待插入节点X 为其父节点的右儿子
![IMG](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/DS-12/5.png)

2. 内侧插入，即待插入节点X 为其父节点的左儿子
![IMG](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/DS-12/6.png)

[参考blog](https://blog.csdn.net/wenqian1991/article/details/26621657)
[参考blog2](https://blog.csdn.net/tanrui519521/article/details/80980135?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase)




