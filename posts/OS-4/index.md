# OS总结 Part-4



设备管理,文件系统
<!--more-->

# 设备管理
 - 物理设备:
    - I/O系统中实际安装的设备
    - 物理名: ID或字符串
 - 逻辑设备
    - 应用软件使用的设备
    - 逻辑名:友好名(Friendly Name)
 - 设备映射功能
   - 设备管理模块将逻辑设备映射到物理设备的功能
   - 从应用软件的角度看,逻辑设备是一类物理设备的抽象
   - 从设备管理程序的角度看,物理设备时逻辑设备的实例
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-4/1.png)
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-4/2.png)
设备驱动程序的特点
 - 设备驱动程序与硬件密切相关
 - 每类设备都要配置特定的驱动设备
 - 驱动程序一般由设备厂商根据操作系统要求编写
 - 操作系统仅对与设备驱动的接口提出要求

# Spooling系统
## 独占型设备
 - 任意时间段内最多只能被**一个进程**占用
 - 使用时,进程首先向系统申请,可能进入阻塞状态
    - 当设备可用时,唤醒一个等待进程
    - 使用完毕以后,进程必须释放设备

## 共享型设备
 - I/O传输单位->块
 - 宏观上,一个共享型设备可以被多个进程同时占用
 - 微观上,多个进程交替使用同一设备
 - 进程使用这类设备时,**无需申请或释放设备**,也不存在某个进程占用设备的问题

## 虚拟分配
### 虚拟技术
在一类物理设备上模拟另一类物理设备的技术
借助辅存部分区域模拟独占设备,将独占设备转换为共享设备

### 虚拟设备
 - 用来模拟独占设备的**部分辅存**称为虚拟设备,虚拟独占设备
 - 输入井:模拟输入设备的辅存区域
 - 输出井:模拟输出设备的辅存区域
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-4/3.png)

### 分配
 - 当进程需要与独占设备交换信息时,就采用虚拟技术将与该独占设备所对应的虚拟设备(部分辅存)分配给他
 - Spooling兄同时虚拟技术和虚拟分配的实现
    - Simultanesus Periphernal Operations Online
    - 外部设备同时联机操作(假脱机输入/输出操作)

## Spooling结构
 - 输入井和输出井
    - **磁盘**开辟的两个存储区域
    - 输入井模拟脱机输入时的磁盘
    - 输出井模拟脱机输出时的磁盘
 - 输入缓冲区和输出缓冲区
    - **内存**中开辟的存储区域
    - 输入缓冲区:暂存输入数据,以后再传送到输入井
    - 输出缓冲区:暂存输出数据,以后再传送到输出井
 - 输入监控进程和输出监控进程
    - 输入监控进程模拟脱机输入的卫星机,将用户要求的数据从输入设备通过输入缓冲区再传送到输入井,当用户进程需要数据时,直接从输入井读入所需数据
    - 输出监控进程模拟脱机输出的卫星机,用户进程将输出数据从内存先传送到输出井,当输出设备空闲时,再将输出井的数据传送到输出设备上
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-4/4.png)

# 文件系统
## 文件属性
指定文件的类型,操作特性和存取保护等一组信息
文件属性存放在文件所在目录的**目录文件**中
MS-DOS系统中,文件属性占目录项的一个字节
 - 00000001:只读属性
 - 00000010:隐藏属性

## 文件的结构
### 逻辑结构
 - 用户的观点
 - 为用户提供罗技结构清晰,使用方便的文件
 - 强调文件信息项的构成方式和用户的存取方式

### 物理结构
 - 系统的观点
 - 文件在存储设备上的存储结构
 - 强调合理利用存储空间,缩短I/O存取时间

## 文件的逻辑结构
1. 记录式文件
    - 信息项式记录,结构化数据
    - 文件中需要保存记录长度和数量等说明信息
    - 浪费存储空间
2. 流式文件
    - 信息项是字节,文件长度是字节的数量
    - 文件无需额外的说明信息或控制信息
    - 节省存储空间

## 物理存取结构
### 顺序存取
 - 按文件信息项排列顺序来依次存取
 - 读写指针
    - 文件打开时,读写指针指向第一个信息项(字节)
    - 每存取一个信息项,读写指针自动加1,而指向下一个信息项
 
### 随机存取
 - 直接存取,存取操作时指定存取的位置
 - 对流式文件或记录为定长的记录式文件容易确定存取位置
 - 对记录不定长的记录式文件定位较为麻烦 

# FAT文件系统
File Allocation Table
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-4/5.png)
**串联文件:存储块next域指向下一个存储块**
文件分配表的缺点
 - 读文件时,先读FAT,影响使用效率
 - FAT要占用存储空间
   - 存储容量越大,存储块就多,FAT元素就越多,且元素位宽越长,占用额外的存储空间就越多
 - 若存储块有2<sup>N</sup>,FAT就有2<sup></sup>个元素,每项至少需要N位的位宽

1. 扇区:磁盘上最小可寻址存储单元(512字节)
2. 簇(cluster) = 存储块:
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-4/6.png)
设备的最小存取单元,固定数量的扇区
簇的例子:
360KB磁盘:簇 = 2个扇区(1024字节)
10MB磁盘: 簇 = 8个扇区(4096字节)
2GB磁盘: 簇 = 64个扇区簇(32KB)

磁盘容量 = FAT * 簇容量 = FAT长度 * 簇扇区数 * 512字节
若N = 16, 簇扇区数 = 64
 - 磁盘容量 = 2<sup>16</sup>簇 * 64扇区 * 512字节 = 2GB
 - N越大,能识别的簇越多,能支持的磁盘容量越大

## FAT16
FAT元素宽度2字节,即16Bit
每簇最大64扇区,磁盘分区最大(2G)
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-4/9.png)
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-4/8.png)

# 存储空间管理
记录磁盘空闲块的方法
## 空闲文件管理
### 空闲文件目录
1. 空闲文件
   将连续空闲分区看成一个特殊文件,由多个连续空闲块组成
2. 空闲文件目录
   ![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-4/10.png)
    - 所有空闲文件代表存储空间设备全部空闲空间
    - 为空闲文件建立的专门目录:空闲文件目录
    - 每个表项对应一个空闲文件,包括一个空闲块号,空闲块个数等信息

### 空闲块链
 - 把所有空闲块链接在一起
 - 当申请者需要空闲块时,链头开始搜索所需空闲块
 - 当回收空闲块时,把释放的空闲块逐个加在链尾

### 位示图
![img](https://tronwei-1254020584.cos.ap-beijing.myqcloud.com/CO-4/7.png)

## 文件目录管理
1. 文件目录
    - 文件名址录,记录文件名和存放地址的目录表
    - 具有将文件名转换为外存物理地址的功能
    - 文件属性也记录在目录中
2. 目录文件
   文件目录以文件形式存于外存,这个文件叫目录文件





